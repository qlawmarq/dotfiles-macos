# ====================================================================================
# tmux Configuration - Optimized for Local & Remote (iPhone) Access
# ====================================================================================
#
# Design Philosophy:
# - Local: Match zsh/VSCode keybindings for seamless experience
# - Remote (iPhone): Optimize for small screens and touch input
# - Both: Smooth clipboard integration and intuitive operations
#
# Copy & Paste:
# - Mouse drag to select â†’ Auto-copy to clipboard
# - Cmd+V to paste (macOS standard)
# - Right-click to paste (works on iPhone too)
#
# ====================================================================================

# ====================================================================================
# BASIC SETTINGS
# ====================================================================================

# Use tmux-256color for better color support (tmux 3.2+)
set -g default-terminal "tmux-256color"

# Enable RGB color support
set -as terminal-features ",*:RGB"

# Fix UTF-8 line drawing issues (prevents markdown table corruption)
set -as terminal-overrides ",*:U8=0"

# Enable mouse support for easier navigation (especially on iPhone)
set -g mouse on

# Start window and pane numbering from 1 (more ergonomic)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed (no gaps)
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 100000

# Fix ESC delay in vim (instant ESC key response)
set -sg escape-time 0

# Aggressive resize (only resize when smaller client is viewing)
setw -g aggressive-resize on

# Don't rename windows automatically (preserve custom names)
set -g allow-rename off

# ====================================================================================
# KEY BINDINGS - ZSH/VSCODE COMPATIBLE
# ====================================================================================

# Use Emacs-style key bindings for command prompt (matches zsh default)
# Ctrl+A: beginning of line, Ctrl+E: end of line, Ctrl+K: kill to end, etc.
set -g status-keys emacs

# Use vi-style key bindings for copy mode (vim-like navigation)
setw -g mode-keys vi

# Reload config file easily
bind r source-file ~/.tmux.conf \; display "tmux.conf reloaded!"

# Intuitive pane splitting (| for vertical, - for horizontal)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Pane navigation with vim-like keys (no prefix needed for Alt+arrows)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Also keep hjkl navigation (with prefix)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing with vim-like keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation (Ctrl+Left/Right without prefix)
bind -n C-Left previous-window
bind -n C-Right next-window

# ====================================================================================
# CLIPBOARD INTEGRATION - MACOS (Cmd+V & Right-click paste)
# ====================================================================================

# Enable system clipboard integration (tmux 2.6+)
set -s set-clipboard on

# Copy mode bindings (vi-style with clipboard integration)
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "pbcopy"

# Mouse drag to copy (auto-copy on mouse release)
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "pbcopy"

# Right-click to paste (works on iPhone and desktop)
bind -n MouseDown3Pane select-pane -t= \; paste-buffer

# Quick paste with prefix + p (alternative method)
bind p paste-buffer

# Quick copy mode with prefix + [
bind [ copy-mode

# ====================================================================================
# DISPLAY SETTINGS - IPHONE OPTIMIZED
# ====================================================================================

# Status bar at top (iPhone keyboard doesn't cover it)
set -g status-position top

# Update status bar frequently
set -g status-interval 5

# ====================================================================================
# COLOR SCHEME - HIGH CONTRAST FOR MOBILE
# ====================================================================================

# Status bar colors (simple and readable)
set -g status-style bg=black,fg=white

# Current window highlight (bright and obvious)
setw -g window-status-current-style bg=blue,fg=white,bold
setw -g window-status-style bg=black,fg=white

# Pane border (clear distinction between panes)
set -g pane-border-style fg=colour240
set -g pane-active-border-style fg=colour33,bold

# Message style
set -g message-style bg=yellow,fg=black,bold

# ====================================================================================
# STATUS BAR - MINIMAL & MOBILE-FRIENDLY
# ====================================================================================

# Left side: session name only (short and clear)
set -g status-left '[#S] '
set -g status-left-length 20

# Right side: minimal info (just time, no date/seconds for space saving)
set -g status-right '%H:%M'
set -g status-right-length 10

# Window list format (compact)
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format ' #I:#W '

# ====================================================================================
# MOUSE BEHAVIOR - ENHANCED FOR MOBILE
# ====================================================================================

# Enhanced mouse wheel behavior in copy mode
bind -n WheelUpPane if -Ft= "#{||:#{pane_in_mode},#{mouse_any_flag}}" \
    "send -M" \
    "if -F '#{alternate_on}' 'send-keys -N 3 Up' 'copy-mode -e'"

bind -n WheelDownPane if -Ft= "#{||:#{pane_in_mode},#{mouse_any_flag}}" \
    "send -M" \
    "if -F '#{alternate_on}' 'send-keys -N 3 Down'"

# ====================================================================================
# COPY MODE - VIM-STYLE ENHANCEMENTS
# ====================================================================================

# Additional copy mode bindings for easier text selection
bind -T copy-mode-vi C-v send -X rectangle-toggle
bind -T copy-mode-vi Escape send -X cancel

# ====================================================================================
# VISUAL IMPROVEMENTS
# ====================================================================================

# Display pane numbers for longer (easier to see on small screens)
set -g display-panes-time 3000

# Display messages for longer
set -g display-time 2000

# ====================================================================================
# ADDITIONAL FEATURES
# ====================================================================================

# Enable focus events (for vim/neovim integration)
set -g focus-events on

# Monitor activity in other windows
setw -g monitor-activity on
set -g visual-activity off

# ====================================================================================
# QUICK REFERENCE
# ====================================================================================
#
# === Copy & Paste ===
# - Mouse drag: Select and auto-copy to clipboard
# - Cmd+V: Paste from clipboard (macOS standard)
# - Right-click: Paste from clipboard (works on iPhone)
# - Prefix + p: Paste (alternative)
#
# === Copy Mode (Prefix + [) ===
# - h/j/k/l: Navigate
# - v: Start selection
# - y: Copy to clipboard
# - Escape: Exit copy mode
#
# === Pane Management ===
# - Prefix + |: Split vertically
# - Prefix + -: Split horizontally
# - Alt + Arrow: Navigate panes (no prefix)
# - Prefix + h/j/k/l: Navigate panes (vim-style)
# - Prefix + H/J/K/L: Resize pane
#
# === Window Management ===
# - Prefix + c: New window
# - Ctrl + Left/Right: Navigate windows (no prefix)
#
# === Other ===
# - Prefix + r: Reload config
# - Prefix + d: Detach from session
# - Mouse: Click to select pane, drag to resize
#
# ====================================================================================
