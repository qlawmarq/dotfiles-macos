---
description: コンパクト後の会話履歴を復元、または過去のトランスクリプトを管理
category: session-management
allowed-tools: Bash, Read, Glob
argument-hint: (引数なし = 最新のトランスクリプトを復元) または 実行したい操作を記述 (例: "過去の会話を一覧表示", "認証について話した時を探す")
---

# Claude コマンド: トランスクリプト管理

## 主な目的

会話のトランスクリプト（記録）を管理し、コンパクト（要約）イベント後に詳細なコンテキストを復元します。

## トランスクリプトの保存場所

PreCompact フックにより、コンパクト実行時に自動的にトランスクリプトが保存されます：
- 保存先: `.data/transcripts/`
- ファイル名形式: `compact_YYYYMMDD_HHMMSS_[session-id].txt`

## 利用可能なアクション

### 主な機能
1. **復元** - 最新または指定したトランスクリプトを会話に読み込む
2. **一覧表示** - 保存されているトランスクリプトのリストを表示
3. **検索** - 過去の会話から特定のトピックやキーワードを探す

## ユーザーの意図を理解する

ユーザーのリクエスト: $ARGUMENTS

引数が指定されていない場合、**最新のトランスクリプトを復元** します（コンパクト後の最も一般的な使用例）。

それ以外の場合は、ユーザーの自然言語リクエストを解釈して、トランスクリプトで何をしたいかを理解します。

## 実装アプローチ

### 1. トランスクリプト一覧を取得

```bash
# 利用可能なトランスクリプトをリスト表示（新しい順）
ls -lt .data/transcripts/compact_*.txt | head -10
```

### 2. 最新のトランスクリプトを復元

```bash
# 最新のトランスクリプトファイルを読み込む
latest=$(ls -t .data/transcripts/compact_*.txt | head -1)
cat "$latest"
```

このコマンドの出力が自動的に会話コンテキストに読み込まれます。

### 3. 特定のトランスクリプトを検索

```bash
# キーワードで検索（例：認証）
grep -l "認証" .data/transcripts/compact_*.txt
```

### 4. 特定のトランスクリプトを読み込む

```bash
# ファイル名やセッションIDで特定のトランスクリプトを読み込む
cat .data/transcripts/compact_20251017_150000_abc123.txt
```

## ⚠️ 重要: 出力処理の要件

**トランスクリプトの内容は stdout に直接出力されます。このコンテンツは会話コンテキストに流れ込む必要があります。**

### 🚫 絶対にしないこと:
```bash
# 間違い - コンテキスト読み込みが阻害されます！
cat "$latest" > /tmp/output.txt

# 間違い - これもコンテキスト読み込みが阻害されます！
cat "$latest" | head -100
```

### ✅ 常にこうする:
```bash
# 正しい - 出力を stdout に直接流す
cat "$latest"

# コンテンツは自動的に会話の一部になります
```

**理由**: このツールの目的は、トランスクリプトのコンテンツを会話コンテキストに注入することです。出力をリダイレクトやパイプすると、この目的が完全に損なわれます！

## レスポンスガイドライン

- 自然で会話的な言葉遣いを使用
- 専門用語を避ける（「セッション」より「会話」、「トランスクリプト」より「チャット」）
- ユーザーが結果で何ができるかに焦点を当てる

## 自然なレスポンスの例

**復元後:**
"✅ 会話履歴全体の復元に成功しました！これまでの会話の全履歴が現在のコンテキストで利用可能になりました。"

**検索後:**
"認証について話した箇所を3つ見つけました。関連する抜粋は以下の通りです..."

**一覧表示後:**
"最近の会話は以下の通りです:
- 2時間前: フックについての質問から開始...
- 昨日: 合成パイプラインの作業..."

## 覚えておくこと

あなたの役割は:
1. ユーザーが何を求めているかを理解する
2. 適切な bash コマンドでトランスクリプトを取得する
3. 自然な形で提示する

あなたの言語理解能力を信頼して、リクエストを解釈し、適切なアクションを選択してください。
