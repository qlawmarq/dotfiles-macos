name: "PRP レビューコマンドの実装"
description: |

---

## 目標

**機能目標**: Claude Code 用の汎用的な PRP レビューコマンドを実装し、作成された PRP の品質を体系的に評価して改善提案を提供する

**成果物**:
- `modules/claude/commands/prp/prp-review_JA.md` - 日本語版 PRP レビューコマンド
- `modules/claude/commands/prp/prp-review.md` - 英語版 PRP レビューコマンド

**成功の定義**:
- PRP ファイルを引数として受け取り、品質を包括的に評価できる
- 構造的完全性、コンテキスト完全性、情報密度の観点から評価を提供できる
- 具体的で実行可能な改善提案を生成できる
- 既存の PRP コマンド（`prp-create`, `prp-execute`）と一貫性のある構造を持つ

## ユーザーペルソナ

**対象ユーザー**: ソフトウェア開発者、AI エージェントの利用者

**ユースケース**:
1. PRP を作成した後、実装前に品質を確認したい
2. 既存の PRP をブラッシュアップして、より高品質な実装を実現したい
3. PRP のベストプラクティスを学びながら改善したい

**ユーザージャーニー**:
1. ユーザーが `/prp-review PRPs/my-feature.md` を実行
2. Claude が PRP を読み込んで解析
3. 品質基準に基づいて評価を実施
4. 構造化されたフィードバックと改善提案を提供
5. 必要に応じて改善版 PRP の生成を提案

**対処する課題**:
- PRP の品質が低いと実装が失敗したり、不完全な実装になる
- どのように PRP を改善すべきか分からない
- PRP のベストプラクティスを知りたい

## なぜ

- **ビジネス価値**: PRP の品質向上により、実装の成功率が向上し、開発効率が改善される
- **既存機能との統合**: `prp-create` で作成した PRP を `prp-execute` で実行する前の品質保証ステップとして機能
- **解決する問題**: PRP の品質が低いことによる実装失敗やコミュニケーションコストの増加を防ぐ

## 何を

### 主要機能

1. **PRP ファイルの読み込みと解析**
   - 引数として PRP ファイルパスを受け取る
   - PRP の構造を解析し、各セクションを抽出

2. **品質評価の実施**
   - 構造的完全性のチェック
   - コンテキスト完全性のチェック
   - 情報密度のチェック
   - 実装可能性のチェック

3. **構造化されたフィードバックの生成**
   - 評価結果のサマリー
   - セクション別の詳細評価
   - 具体的な改善提案
   - スコアリング（1-10）

4. **改善版 PRP の生成提案**
   - 重大な問題がある場合は改善版の生成を提案
   - 既存の内容を保持しつつ、不足している要素を補完

### 成功基準

- [ ] PRP ファイルを正しく読み込んで解析できる
- [ ] 5 つの品質観点（構造的完全性、コンテキスト完全性、情報密度、実装可能性、品質基準）から評価できる
- [ ] 各観点で具体的な改善提案を提供できる
- [ ] 信頼スコア（1-10）を算出できる
- [ ] ユーザーが改善すべき点を明確に理解できる

## 必要なすべてのコンテキスト

### コンテキスト完全性チェック

_この PRP を書く前に検証: 「このコードベースについて何も知らない人が、これを成功裏に実装するために必要なすべてを持っているか？」_

✅ すべての必要な情報が含まれています

### ドキュメントと参照

```yaml
# 必読 - コンテキストウィンドウに含める
- file: modules/claude/project-template/PRPs/README_JA.md
  why: PRP の目的、構造、ベストプラクティスを理解するため
  pattern: PRP の定義と品質基準
  critical: PRP の 3 つの重要レイヤー（コンテキスト、実装詳細、検証ゲート）を理解すること

- file: modules/claude/project-template/PRPs/templates/prp_base_JA.md
  why: PRP テンプレートの完全な構造と必須セクションを把握するため
  pattern: 目標、コンテキスト、実装設計図、検証ループの構造
  gotcha: すべてのセクションが必須ではない - プロジェクトに応じて適応が必要

- file: modules/claude/commands/prp/prp-create_JA.md
  why: PRP 作成時の品質チェック基準を理解するため
  pattern: コンテキスト完全性チェック、テンプレート構造準拠、情報密度基準
  critical: 「このコードベースについて何も知らない人が実装に必要なすべてを持っているか」という基準

- file: modules/claude/commands/prp/prp-execute_JA.md
  why: PRP 実行時に期待される要素を理解するため
  pattern: 実装プロセスと検証ステップ
  gotcha: PRP は実装者が一度で成功できるように設計されるべき

- file: modules/claude/commands/git/pr-review_JA.md
  why: レビューコマンドの構造と観点を理解するため
  pattern: レビューフォーカスエリア、レビューガイドライン、構造化されたフィードバック
  critical: 建設的で具体的なフィードバックを提供すること
```

### 現在のコードベースツリー

```bash
modules/claude/commands/prp/
├── prp-create.md
├── prp-create_JA.md
├── prp-execute.md
├── prp-execute_JA.md
├── prp-init.md
├── prp-init_JA.md
├── prp-lang-setup.md
├── prp-lang-setup_JA.md
├── prp-planning-create.md
└── prp-planning-create_JA.md
```

### 追加するファイルとファイルの責任を含む望ましいコードベースツリー

```bash
modules/claude/commands/prp/
├── prp-create.md
├── prp-create_JA.md
├── prp-execute.md
├── prp-execute_JA.md
├── prp-init.md
├── prp-init_JA.md
├── prp-lang-setup.md
├── prp-lang-setup_JA.md
├── prp-planning-create.md
├── prp-planning-create_JA.md
├── prp-review.md          # 新規: 英語版 PRP レビューコマンド
└── prp-review_JA.md       # 新規: 日本語版 PRP レビューコマンド
```

### コードベースとライブラリの既知の注意点

```yaml
# Claude Code スラッシュコマンドの構造
# - YAML フロントマター（description, category, allowed-tools, argument-hint）
# - 使用方法セクション
# - コマンドが行うことの説明
# - フォーカスエリア/観点
# - ガイドライン
# - 追加ガイダンス（$ARGUMENTS）

# PRP の品質基準
# - コンテキスト完全性: 実装に必要な情報がすべて含まれているか
# - テンプレート構造準拠: 必須セクションがすべて含まれているか
# - 情報密度: 参照が具体的で実行可能か
# - 実装可能性: タスクが依存関係順になっているか
# - 品質基準: 検証ゲートが包括的か
```

## 実装設計図

### データモデルと構造

Claude Code スラッシュコマンドとして実装するため、特定のデータモデルは不要です。
マークダウン形式で構造化されたコマンドファイルを作成します。

### 実装タスク（依存関係順）

```yaml
タスク1: modules/claude/commands/prp/prp-review_JA.md を作成
  - 実装: 日本語版 PRP レビューコマンドのマークダウンファイル
  - パターンに従う: modules/claude/commands/git/pr-review_JA.md（レビューコマンドの構造）
  - 命名: prp-review_JA.md（日本語版の命名規則）
  - 配置: modules/claude/commands/prp/ ディレクトリ
  - 内容:
    - YAML フロントマター（description, category, allowed-tools, argument-hint）
    - 使用方法セクション
    - コマンドが行うことの説明（8 ステップ）
    - レビューフォーカスエリア（5 つの観点）
    - レビューガイドライン
    - 追加ガイダンス
  - 品質基準:
    - PRP の品質評価基準を明確に定義
    - 具体的な改善提案の方法を説明
    - 既存の PRP コマンドと一貫性のある構造

タスク2: modules/claude/commands/prp/prp-review.md を作成
  - 実装: 英語版 PRP レビューコマンドのマークダウンファイル
  - パターンに従う: タスク1 で作成した日本語版を英語に翻訳
  - 命名: prp-review.md（英語版の命名規則）
  - 配置: modules/claude/commands/prp/ ディレクトリ
  - 依存関係: タスク1 が完了していること
  - 内容: タスク1 と同じ構造で英語版
  - 品質基準: 日本語版と内容が一致していること

タスク3: 作成したコマンドの動作確認
  - 実装: 実際に `/prp-review` コマンドを実行して動作を確認
  - 検証方法:
    - 既存の PRP ファイル（存在する場合）をレビュー
    - または、サンプル PRP を作成してレビュー
  - 期待結果:
    - コマンドが正しく展開される
    - PRP ファイルを読み込んで解析できる
    - 構造化されたフィードバックが生成される
```

### 実装パターンと重要な詳細

```markdown
# PRP レビューコマンドの構造

## YAML フロントマター
---
description: 生成された PRP の品質をレビューして改善提案を提供
category: prp
allowed-tools: Read, Glob, Write
argument-hint: [PRP ファイルパス]
---

## レビューフォーカスエリア（5 つの観点）

### 1. 構造的完全性
- すべての必須セクションが含まれているか
- テンプレート構造に準拠しているか
- セクションの順序が適切か

### 2. コンテキスト完全性
- 実装に必要な情報が十分に含まれているか
- 「このコードベースについて何も知らない人が実装できるか」
- 参照ドキュメントが適切か
- 既知の注意点が記載されているか

### 3. 情報密度
- URL にセクションアンカーが含まれているか
- ファイル参照に具体的なパターンが含まれているか
- タスク仕様に命名規則と配置が含まれているか
- 検証コマンドがプロジェクト固有で実行可能か

### 4. 実装可能性
- 実装タスクが依存関係順になっているか
- パターン参照が明確か
- 具体的な実装方法が示されているか
- エッジケースが考慮されているか

### 5. 品質基準
- 目標セクションに具体的な機能目標、成果物、成功定義があるか
- 検証ゲートが段階的か（レベル1-4）
- 最終検証チェックリストが包括的か
- アンチパターンが定義されているか

## レビューガイドライン

- **建設的に**: PRP の品質向上に焦点を当てる
- **具体的に**: 正確なセクションと行を指摘し、懸念事項を説明する
- **解決策を提案**: 問題を指摘するだけでなく、具体的な改善案を提供する
- **質問する**: 不明確な部分は明確化を求める
- **良い点を認める**: よく書かれた部分や優れた設計を強調する
- **優先順位を区別**: 修正必須の問題と改善提案を区別する

## スコアリング

各観点を 1-10 で評価し、総合的な信頼スコアを算出:
- 9-10: 優秀（すぐに実装可能）
- 7-8: 良好（軽微な改善で実装可能）
- 5-6: 普通（いくつかの改善が必要）
- 3-4: 要改善（重大な問題がある）
- 1-2: 不十分（大幅な修正が必要）
```

### 統合ポイント

```yaml
# Claude Code の設定には変更不要
# スラッシュコマンドは自動的に検出される

# ユーザーの使用方法
USAGE:
  - "/prp-review PRPs/my-feature.md" - 特定の PRP をレビュー
  - "/prp-review" - 引数なしの場合はレビューしたい PRP を尋ねる
```

## 検証ループ

### レベル 1: 構文とスタイル（即時フィードバック）

```bash
# マークダウンファイルの構文チェック
cat modules/claude/commands/prp/prp-review_JA.md | grep -E "^---$" | wc -l
# 期待: 2（YAML フロントマターの開始と終了）

# YAML フロントマターの検証
head -n 10 modules/claude/commands/prp/prp-review_JA.md | grep "description:"
head -n 10 modules/claude/commands/prp/prp-review_JA.md | grep "category:"
head -n 10 modules/claude/commands/prp/prp-review_JA.md | grep "allowed-tools:"
head -n 10 modules/claude/commands/prp/prp-review_JA.md | grep "argument-hint:"
# 期待: すべての必須フィールドが存在

# 英語版の存在確認
test -f modules/claude/commands/prp/prp-review.md && echo "英語版が存在します" || echo "英語版が見つかりません"
# 期待: 英語版が存在します
```

### レベル 2: 単体テスト（コンポーネント検証）

```bash
# コマンドファイルの基本構造を検証
# 必須セクションの存在確認
grep -q "## 使用方法" modules/claude/commands/prp/prp-review_JA.md && echo "✓ 使用方法セクションあり"
grep -q "## このコマンドが行うこと" modules/claude/commands/prp/prp-review_JA.md && echo "✓ 機能説明セクションあり"
grep -q "## レビューフォーカスエリア" modules/claude/commands/prp/prp-review_JA.md && echo "✓ レビュー観点セクションあり"
grep -q "## レビューガイドライン" modules/claude/commands/prp/prp-review_JA.md && echo "✓ ガイドラインセクションあり"

# 5 つのレビュー観点が定義されているか確認
grep -c "### [0-9]\." modules/claude/commands/prp/prp-review_JA.md
# 期待: 5（5 つの観点）

# 期待: すべてのチェックが通る
```

### レベル 3: 統合テスト（システム検証）

```bash
# 実際に Claude Code でコマンドを実行してテスト

# ステップ1: サンプル PRP を作成（テスト用）
mkdir -p PRPs/test
cat > PRPs/test/sample-prp.md << 'EOF'
name: "サンプル PRP"

## 目標
**機能目標**: テスト用の PRP

## 必要なすべてのコンテキスト
- 情報が不足しています

## 実装設計図
タスクが定義されていません
EOF

# ステップ2: レビューコマンドを実行
# 手動実行: claude -p "/prp-review PRPs/test/sample-prp.md"

# ステップ3: レビュー結果を確認
# - 構造的完全性のチェックが動作するか
# - コンテキスト完全性のチェックが動作するか
# - 具体的な改善提案が提供されるか
# - スコアが算出されるか

# クリーンアップ
rm -rf PRPs/test

# 期待: レビューコマンドが正しく動作し、構造化されたフィードバックが生成される
```

### レベル 4: 創造的＆ドメイン固有の検証

```bash
# 実際の PRP をレビューして品質を確認

# ステップ1: 既存の PRP ファイルを探す
find PRPs -name "*.md" -type f 2>/dev/null | head -n 1

# ステップ2: 見つかった PRP をレビュー
# 手動実行: claude -p "/prp-review [見つかった PRP のパス]"

# ステップ3: レビュー品質を評価
# - 改善提案が具体的で実行可能か
# - レビューガイドラインに従っているか
# - ユーザーが次のアクションを明確に理解できるか

# 期待: 高品質で実用的なレビューが生成される
```

## 最終検証チェックリスト

### 技術検証

- [ ] 日本語版コマンドファイルが正しく作成されている
- [ ] 英語版コマンドファイルが正しく作成されている
- [ ] YAML フロントマターがすべて含まれている
- [ ] マークダウン構文が正しい
- [ ] 必須セクションがすべて含まれている

### 機能検証

- [ ] コマンドが PRP ファイルを読み込んで解析できる
- [ ] 5 つの品質観点から評価できる
- [ ] 構造化されたフィードバックが生成される
- [ ] 具体的な改善提案が提供される
- [ ] スコアリングが機能する

### コード品質検証

- [ ] 既存の PRP コマンドと一貫性のある構造
- [ ] ファイル配置が適切
- [ ] 命名規則に従っている
- [ ] レビューガイドラインが明確
- [ ] ユーザーが使いやすい

### ドキュメントとデプロイメント

- [ ] 使用方法が明確に説明されている
- [ ] レビューフォーカスエリアが明確
- [ ] レビューガイドラインが実用的
- [ ] サンプルコマンドが提供されている

---

## 避けるべきアンチパターン

- ❌ 既存のコマンドと異なる構造にしない
- ❌ 抽象的な評価基準を使わない - 具体的で測定可能な基準を使う
- ❌ 改善提案なしで問題を指摘しない
- ❌ レビュー観点を少なくしすぎない - 包括的な評価が必要
- ❌ スコアリングなしで評価しない - 定量的な評価が重要
- ❌ ユーザーが次のアクションを理解できないフィードバックにしない

---

## 成功指標

**信頼スコア**: 10/10

**検証**: この PRP は、以下の基準を満たしています：
- ✅ コンテキスト完全性: 実装に必要な情報がすべて含まれている
- ✅ テンプレート構造準拠: すべての必須セクションが含まれている
- ✅ 情報密度: 参照が具体的で実行可能
- ✅ 実装可能性: タスクが依存関係順で明確
- ✅ 品質基準: 検証ゲートが包括的で段階的
